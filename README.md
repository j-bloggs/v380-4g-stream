# V380 4G Stream

Download and decrypt live video streams from V380 (Macro Video) 4G cameras via cloud servers, and optionally re-broadcasts as a local RTSP stream. Suitable for V380 4G cameras where local LAN streaming via RTSP is not possible.

## Features

- Download encrypted video streams from V380 4G cameras
- Automatic decryption of H.265 video and AAC audio
- Direct MP4 output (no ffmpeg required)
- Local RTSP server for live viewing in VLC
- Cross-platform (Python 3.7+)

## Installation

```bash
pip install pycryptodome
```

## Usage

### Basic Recording

```bash
# Record for 60 seconds (default)
python v380_stream.py -d DEVICE_ID -p PASSWORD

# Record for 30 seconds
python v380_stream.py -d DEVICE_ID -p PASSWORD --duration 30

# Record video only (no audio)
python v380_stream.py -d DEVICE_ID -p PASSWORD --no-audio
```

### Live Streaming

```bash
# Start RTSP server for live viewing
python v380_stream.py -d DEVICE_ID -p PASSWORD --rtsp

# Then open in VLC:
# vlc rtsp://localhost:8554/stream
```

### Options

| Option | Description |
|--------|-------------|
| `-d, --device-id` | Camera device ID (from QR code) |
| `-p, --password` | Device password |
| `-t, --duration` | Recording duration in seconds (default: 60) |
| `-o, --output-dir` | Output directory (default: `recordings`) |
| `--server` | Override API server IP |
| `--no-audio` | Disable audio recording |
| `--no-mp4` | Don't convert to MP4 (keeps raw H.265/AAC) |
| `--keep-raw` | Keep raw H.265/AAC files after MP4 conversion |
| `--rtsp` | Start RTSP server for live viewing |
| `--rtsp-port` | RTSP server port (default: 8554) |
| `--debug` | Enable debug output and raw stream saving |

## Output

The tool automatically creates a `recordings/` directory (configurable with `-o`).

Output files:
- `v380_YYYYMMDD_HHMMSS.mp4` - Final MP4 file (video + audio)
- `v380_YYYYMMDD_HHMMSS.h265` - Raw H.265 video (with `--no-mp4` or `--keep-raw`)
- `v380_YYYYMMDD_HHMMSS.aac` - Raw AAC audio (with `--no-mp4` or `--keep-raw`)
- `v380_YYYYMMDD_HHMMSS_raw.bin` - Raw stream data (with `--debug`)

Press Ctrl-C to stop recording early.

## Server Configuration

The default API server (`194.195.251.29`) may not work in all regions. V380 uses regional cloud servers. If you experience connection issues, you may need to identify the correct server for your region by capturing traffic from the official V380 Pro app.

Use `--server IP` to specify an alternative server.

## Requirements

- Python 3.7+
- pycryptodome

## Project Structure

```
v380_stream.py          # CLI for live streaming
v380_4g/
├── __init__.py
├── client.py           # Core client (connection, auth)
├── crypto.py           # AES encryption/decryption
├── stream.py           # Live streaming
├── mp4_muxer.py        # Pure Python MP4 muxer
└── rtsp_server.py      # RTSP server for live viewing
```


---

All code Generated by A.I. tools

## License

MIT License
